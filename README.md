# Spring-Boot OAuth2 Setup 

This is a working Spring Boot OAuth project copied from [here](https://howtodoinjava.com/spring5/security5/oauth2-auth-server/).

## Table of Contents
- [Project Setup](#project-setup)
- Authentication with Authorization Code
    - [Retrieving Authorization Code](#retrieving-authorization-code)
    - [Retrieving Token](#retrieving-token-through-oauthtoken)
- Authentication with Password
    - [Authentication with Password](#authentication-with-password)

## Workflow

### Project Setup
1. After cloning the project open it as a maven project in your favorite IDE.

2. Run `mvn package` to install all the dependencies.

3. Start the application through your IDE's play/start button.

### Retrieving Authorization Code
1. We want get authorization grant from resource owner from this URL 
    ```
    http://localhost:8080/oauth/authorize?client_id=clientapp&response_type=code&scope=read_profile_info
    ```
2. This is redirect to `localhost/8080/login` path with a login page generated by `formLogin()`.

3. Login with username `humptydumpty` and password `123456`. 
    ![Login Page](img/login-screen.png)

4. Authorize the `clientapp` to access the resource by ticking off approve and pressing the authorize button.
    ![Authorize Page](img/authorize-screen.png)

5. After pressing authorize you will be redirected to `localhost:8080/login` with a code parameter. Copy that authorization code.

    ![Authorization Code](img/auth-code.png)

### Retrieving Token through `/oauth/token`
1. Create a Postman request with method set to `POST` and url to `localhost:8080/ouath/token`.

2. Under the `Headers` tab add `Authorization` with value `Basic Y2xpZW50YXBwOjEyMzQ1Ng==`

    ![Postman Headers](img/postman-headers.png)

3. Under the `Body` tab select `x-www-form-urlencoded` (this will populate a new header) and add the following key value pairs:
    - `grant_type`: `authorization_code`
    - `redirect_uri`: `localhost:8081/login`
    - `code`: the code you got from the last part

    ![Postman Body](img/postman-body.png)

4. Press send button and you should get an JSON object with JWT access-token.
    ![Return Object](img/return-object.png)

### Authentication with Password
1. Create a Postman request with method set to `POST` and url to `localhost:8080/ouath/token`.

2. Under the `Headers` tab add `Authorization` with value `Basic Y2xpZW50YXBwOjEyMzQ1Ng==`

    ![Postman Headers](img/auth-password.png)

3. Under the `Body` tab select `x-www-form-urlencoded` (this will populate a new header) and add the following key value pairs:
    - `grant_type`: `password`
    - `redirect_uri`: `localhost:8081/login`
    - `username`: `humptygrumpty`
    - `password`: `123456`

4. Press send button and you should get an JSON object with a JWT access-token.
    ![Return Object](img/return-object.png)

### Registering new user via `/user/register`
1. Create a Postman request with method set to `POST` and url to `localhost:8080/user/register`.

2. Under the `Body` tab, select `raw` and then select `JSON (application/json)` from the dropdown menu to the right.

3. In the text box field under the `Body` tab, insert the request body in the following format with the following information (replace capitalized inputs with own credentials):
    ```
    {
        "username": "USERNAME",
        "password": "PASSWORD",
        "authorities":"ROLE_1, ROLE_2, ...",
        "email":"VALID@EMAIL.COM"
    }
    ```
4. Press send button and you should receive a JSON object with the same information that you input in previous step.

5. Check that your new user has been registered by following the steps listed above under the `Authentication with password` header, replacing the given username and password with your new username and password.